<form method="get" action="{% url 'stock_chart' %}">
  <!-- 1) Search box -->
  <label for="symbol-search">Search Symbol:</label>
  <input
    type="text"
    id="symbol-search"
    placeholder="Type to filterâ€¦"
    style="margin-bottom:8px; display:block;"
  />
  <br>
  <!-- 2) Your existing select -->
  <label for="symbol-select">Symbol:</label>
  <select name="symbol" id="symbol-select" size="5" style="width:200px;">
    {% for sym in instrument_list %}
      <option
        value="{{ sym.symbol }}"
        data-security-id="{{ sym.security_id }}"
      >
        {{ sym.symbol }}
      </option>
    {% endfor %}
  </select>
  <br>


  <!-- 3) Hidden security_id -->
  <input type="hidden" name="security_id" id="security-id"/><br/>

  <!-- 4) The rest of your inputs -->
  <label for="start_price_select">Start Price:</label>
  <select name="start_price" id="start_price_select" size="5" style="width:200px;">
      <option  value="open">open</option>
      <option  value="high">high</option>
      <option  value="low">low</option>
      <option  value="close">close</option>
  </select>

  <label>Bar Index Start Date:
    <input type="date" name="start_date" required>
  </label><br/>
  <label>Price-to-Bar Ratio:
    <input type="number" name="price_to_bar_ratio" required>
  </label><br/>
  <label>Start Bar index:
    <input type="number" name="start_bar" required>
  </label><br/>
  <label>Angles (comma-sep):
    <input type="text" name="angles" value="45,63.25">
  </label><br/>

  <button type="submit">Generate Chart</button>
</form>

{% if request.GET %}
  <h3>Chart for {{ request.GET.symbol }}</h3>
  <img src="{% url 'stock_chart' %}?{{ request.GET.urlencode }}" alt="Stock chart">
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', () => {
  const searchInput = document.getElementById('symbol-search');
  const selectEl    = document.getElementById('symbol-select');
  const hiddenInput = document.getElementById('security-id');

  // 1) Filter options as you type
  searchInput.addEventListener('input', () => {
    const filter = searchInput.value.toLowerCase();
    Array.from(selectEl.options).forEach(opt => {
      opt.hidden = !opt.text.toLowerCase().includes(filter);
    });
  });

  // 2) Sync hidden security_id whenever selection changes
  function updateSecurityId() {
    const sel = selectEl.options[selectEl.selectedIndex];
    hiddenInput.value = sel?.dataset.securityId || '';
  }
  selectEl.addEventListener('change', updateSecurityId);

  // 3) Initialize hidden field on load
  if (selectEl.selectedIndex >= 0) updateSecurityId();
});
</script>
